// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
    output   = "../generated/prisma"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

// Enums for Dashboard and strict typing
enum Role {
    USER // Standart Citizen/User
    MUNICIPALITY // Belediye
    ARCHITECT // Mimar/Admin
}

enum GlitchStatus {
    OPEN
    IN_PROGRESS
    RESOLVED
}

// User model to manage roles and authentication for the Dashboard
model User {
    id        String   @id @default(cuid())
    email     String?  @unique
    name      String?
    role      Role     @default(USER)
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

// Original Models from glitch-hunters project

model Glitch {
    id          String  @id @default(uuid())
    latitude    Float
    longitude   Float
    title       String
    description String
    imageUri    String?
    timestamp   Float   @default(0)
    views       Int     @default(0)
    severity    String
    category    String  @default("other")

    // Changed to use String for compatibility but we will strictly use specific values in Dashboard
    status String

    hotfixImageUri String?
    votes          Int       @default(0)
    author         String
    votedBy        String[]
    createdAt      DateTime  @default(now())
    updatedAt      DateTime  @updatedAt
    comments       Comment[]
    votesList      Vote[]
}

model Comment {
    id        String   @id @default(uuid())
    text      String
    author    String
    authorId  String?
    createdAt DateTime @default(now())
    glitchId  String
    glitch    Glitch   @relation(fields: [glitchId], references: [id])
}

model Vote {
    id       String @id @default(uuid())
    userId   String
    value    Int // 1 for up, -1 for down
    glitchId String
    glitch   Glitch @relation(fields: [glitchId], references: [id])

    @@unique([userId, glitchId])
}

model PushToken {
    id        String   @id @default(uuid())
    token     String   @unique
    userId    String?
    createdAt DateTime @default(now())
}
